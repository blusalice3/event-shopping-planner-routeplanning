# 即売会購入巡回表アプリ

即売会（コミケ、コミティアなど）での購入リストを管理するWebアプリケーションです。タブレットやスマートフォンで使用でき、オフラインでも動作します。

## 🚀 クイックスタート

### セットアップ

```bash
npm install
npm run dev
```

ブラウザで `http://localhost:5173` を開きます。

### ビルド

```bash
npm run build
```

## 📱 主な画面と機能

### 1. 即売会リスト画面（ホーム画面）

保存済みの即売会リストが一覧表示されます。

#### 操作方法
- **リストを開く**: リスト名をタップ（クリック）
- **メニューを表示**: リスト名を**長押し**（500ms）すると、右側にメニューが表示されます
  - 🔄 **アイテム更新**: スプレッドシートから最新データを取得して更新
  - ✏️ **名前変更**: 即売会名を変更
  - 📥 **Excel形式で出力**: CSVファイルをダウンロード（バックアップ用）
  - 🗑️ **削除**: リストを削除（確認ダイアログが表示されます）

#### 表示内容
- 保存済みの即売会名の一覧
- リストが1つもない場合は「保存されたリストはありません」と表示

---

### 2. 新規リスト作成画面

即売会の購入リストを新規作成する画面です。3つのインポート方法から選択できます。

#### 方法1: スプレッドシートURLからインポート

**操作方法**
1. 「スプレッドシートURLからインポート」欄にGoogleスプレッドシートのURLを入力
2. 「URLからインポート」ボタンをクリック
3. 即売会名を入力して「リストを作成」ボタンをクリック

**重要事項**
- スプレッドシートは「リンクを知っている全員が閲覧可」に設定する必要があります
- シート名「品目表」のM列～R列、W列が自動的にインポートされます
- インポート後、スプレッドシートURLが保存され、後から「アイテム更新」で最新データを取得できます

#### 方法2: CSVファイルからインポート

**操作方法**
1. 「CSVファイルからインポート」欄で「ファイルを選択」をクリック
2. ローカルのCSVファイルを選択
3. 即売会名を入力して「リストを作成」ボタンをクリック

**データ形式**
- A列～D列（サークル名、参加日、ブロック、ナンバー）が全て入力されている行のみインポートされます
- エクスポートしたCSVファイルを再インポートする場合、配置情報も復元されます

#### 方法3: 手動入力

**操作方法**
1. スプレッドシートのM列～R列、W列をコピー
2. 「サークル名」欄に貼り付け（Ctrl+V / Cmd+V）
3. データが自動的に各欄に振り分けられます
4. 即売会名を入力して「リストを作成」ボタンをクリック

**入力欄の説明**
- **サークル名**: サークル名（M列）
- **参加日**: 参加日（N列、例: 1日目、2日目）
- **ブロック**: ブロック（O列、例: A、G、東1）
- **ナンバー**: ナンバー（P列、例: 01a、03b）
- **タイトル**: タイトル（Q列）
- **頒布価格**: 頒布価格（R列、数値）
- **備考**: 備考（W列）
- **URL**: URL（任意）

---

### 3. 購入リスト画面

即売会の購入リストを表示・管理するメイン画面です。

#### 画面構成

**ヘッダー部分**
- **即売会名**: 現在開いている即売会名
- **参加日タブ**: 1日目、2日目などのタブで参加日を切り替え
- **モード切り替え**: 参加日タブを**長押し**（500ms）で編集モード⇔実行モードを切り替え
- **検索バー**: サークル名、タイトル、備考欄を検索
- **ソートボタン**: 購入状態でフィルタリング（実行モード時）
- **ブロックフィルタ**: 特定のブロックのみ表示（編集モード時）
- **一括操作ボタン**: 選択したアイテムの移動・削除など（編集モード時）

**アイテムカード部分**
各購入アイテムがカード形式で表示されます。

**サマリーバー（画面下部固定）**
- 購入済み件数と全体件数の表示
- 残りの合計金額（未購入・後回し・遅参のアイテムの合計）

#### アイテムカードの表示内容

**左側エリア**
- **チェックボックス**: アイテムを選択（複数選択可能）
- **上下移動ボタン**: アイテムの順序を1つずつ変更
- **ドラッグハンドル**: ドラッグ&ドロップで順序を変更

**中央エリア**
- **参加日とブロック-ナンバー**: 例「1日目 G-01a」
- **サークル名**: サークル名
- **警告タグ**: 備考欄に「優先」「委託無」が含まれる場合、または同じサークル名のアイテムが複数ある場合にアイコン表示
  - 「優先」: 優先.png
  - 「委託無」: 委託無.png
  - 「複数種」: 複数種.png（同じサークル名のアイテムが複数ある場合）
- **タイトル**: タイトル名（購入済み・売切・欠席の場合は取り消し線が表示）
- **備考欄**: 編集可能なテキスト入力欄

**右側エリア**
- **購入状態ボタン**: 6つの状態を循環切り替え
- **価格表示**: ドロップダウンで価格を選択・変更可能

#### 購入状態の一覧

| 状態 | アイコン | 背景色 | 説明 |
|------|---------|--------|------|
| 未購入 | 灰色の円 | ブロックごとの色分け | まだ購入していない状態 |
| 購入済 | 緑色のチェック | 緑色背景 | 購入が完了した状態 |
| 売切 | 赤色の× | 赤色背景 | 売り切れていた状態 |
| 欠席 | 黄色のマイナス | 黄色背景 | サークルが欠席していた状態 |
| 後回し | 紫色の一時停止 | 紫色背景 | 後で購入する予定の状態 |
| 遅参 | 青色の時計 | 青色背景 | サークルが遅れて参加する予定の状態 |

**操作方法**
- 購入状態ボタンをタップすると、上記の順序で状態が切り替わります

#### 色分け表示の仕組み

- **ブロック色**: 未購入アイテムはブロック値（A、G、東1など）ごとに異なる色で表示されます
- **状態色**: 購入済み・売切・欠席などの状態は背景色で識別できます
- **縞模様**: 同じブロックのアイテムが隣り合う場合、濃淡が交互に表示されます

---

## 🎯 基本的な使い方

### 編集モード（事前計画モード）

即売会当日の購入計画を立てるモードです。

#### モードの切り替え
1. 参加日のタブを**長押し**（500ms）
2. 編集モードに切り替わります

#### 画面表示
- **2列表示**になります
  - **左列（実行列）**: 当日購入するアイテムを表示
  - **右列（候補リスト）**: 候補となるアイテムを表示

#### 基本的な操作手順

**1. 候補リストから購入アイテムを選択**
- 候補リストのアイテムのチェックボックスをタップして選択（複数選択可能）
- 範囲選択も可能: 最初のアイテムを長押し、最後のアイテムまでドラッグして範囲選択

**2. 選択したアイテムを実行列に移動**
- ヘッダーの「選択したアイテムを左列に移動」ボタンをクリック
- 選択したアイテムが実行列の末尾に追加されます

**3. 実行列でアイテムの順序を調整**
- **ドラッグ&ドロップ**: アイテムをドラッグして希望の位置にドロップ
- **上下移動ボタン**: アイテムカード左側の上下矢印ボタンで1つずつ移動
- 複数選択した状態でドラッグ&ドロップすると、選択したアイテムがまとめて移動します

**4. ブロックフィルタで絞り込み**
- ヘッダーのブロックフィルタで特定のブロックのみ表示できます
- 例: 「G」を選択すると、Gブロックのアイテムのみ表示されます

**5. ナンバー順にソート**
- ヘッダーのソートボタン（昇順/降順）でナンバー順に並び替えが可能です

**6. 実行列から候補リストに戻す**
- 実行列のアイテムを選択して「選択したアイテムを右列に移動」ボタンをクリック

#### その他の操作

- **アイテムの編集**: アイテムカードを長押しして「編集」を選択
- **アイテムの削除**: アイテムカードを長押しして「削除」を選択
- **一括削除**: 複数選択して「選択したアイテムを削除」ボタンをクリック
- **検索**: ヘッダーの検索バーでサークル名・タイトル・備考欄を検索（Enterキーで次を検索）

---

### 実行モード（当日使用モード）

即売会当日に実際に使用するモードです。

#### モードの切り替え
1. 参加日のタブを**長押し**（500ms）
2. 実行モードに切り替わります

#### 画面表示
- **1列表示**になります（実行列のアイテムのみ表示）
- 候補リストのアイテムは非表示になります

#### 基本的な操作手順

**1. 購入状態を更新**
- 各アイテムの購入状態ボタンをタップして状態を変更
- 購入済み、売切、欠席、後回し、遅参などに切り替えられます

**2. 状態別にフィルタリング**
- ヘッダーのソートボタンで状態別にフィルタリング
- 「巡回順」「後回し」「遅参」「欠席」「売切」「購入済」の順で切り替わります

**3. 購入進捗を確認**
- 画面下部のサマリーバーで購入済み件数と残りの合計金額を確認
- 残りの合計金額は、未購入・後回し・遅参のアイテムの価格の合計です

**4. アイテムの順序を調整**
- ドラッグ&ドロップまたは上下移動ボタンで順序を変更可能です

#### その他の操作

- **アイテムの編集**: アイテムカードを長押しして「編集」を選択
- **アイテムの削除**: アイテムカードを長押しして「削除」を選択
- **URLを開く**: アイテムにURLが設定されている場合、長押しメニューから「URLを開く」を選択
- **検索**: ヘッダーの検索バーでアイテムを検索（検索結果は赤い枠でハイライト表示）

---

### その他の機能

#### アイテムの追加
1. ヘッダーの「新規リスト作成」タブをクリック
2. 既存のリストに追加する場合は、各入力欄に情報を入力
3. 「リストに追加」ボタンをクリック

#### アイテムの編集
1. アイテムカードを長押し（500ms）
2. 「編集」を選択
3. 編集画面で情報を変更
4. 「アイテムを更新」ボタンをクリック

#### アイテムの削除
1. アイテムカードを長押し（500ms）
2. 「削除」を選択
3. 確認ダイアログで「OK」をクリック

#### ズーム機能
- 画面左下のズームコントロールで表示倍率を変更（30%～150%）
- タブレットやスマートフォンでの表示を調整できます

#### 検索機能
- ヘッダーの検索バーにキーワードを入力
- サークル名、タイトル、備考欄が検索対象です
- 「次を検索」ボタンまたはEnterキーで次の検索結果に移動
- 検索結果は赤い枠でハイライト表示されます
- 検索結果の件数が表示されます（例: 「2 / 5」）

---

## 📊 データ形式

### スプレッドシート形式（M列から始まる）

Googleスプレッドシートからインポートする際の形式です。

| 列 | 項目 | 説明 |
|----|------|------|
| M列 | サークル名 | サークル名 |
| N列 | 参加日 | 例: 1日目、2日目 |
| O列 | ブロック | 例: A、G、東1 |
| P列 | ナンバー | 例: 01a、03a |
| Q列 | タイトル | タイトル名 |
| R列 | 頒布価格 | 数値（円） |
| W列 | 備考 | 備考欄 |

### CSVエクスポート形式（A列から始まる）

リストをエクスポートした際の形式です。

| 列 | 項目 | 説明 |
|----|------|------|
| A列 | サークル名 | サークル名 |
| B列 | 参加日 | 参加日 |
| C列 | ブロック | ブロック |
| D列 | ナンバー | ナンバー |
| E列 | タイトル | タイトル |
| F列 | 頒布価格 | 頒布価格 |
| G列 | 購入状態 | None/Purchased/SoldOut/Absent/Postpone/Late |
| H列 | 備考 | 備考欄 |
| I列 | 列の種類 | 実行列/候補リスト |
| J列 | 列内順番 | 列内での順序 |
| K列 | URL | URL（設定されている場合） |

---

## 💾 データ管理

### データの保存場所
- すべてのデータはブラウザの**localStorage**に自動保存されます
- サーバーには送信されません（プライバシー保護）
- ページをリロードしても状態が保持されます

### バックアップ
- 定期的にCSV形式でエクスポートしてバックアップすることを推奨します
- 即売会リスト画面でリストを長押し→「Excel形式で出力」を選択

### データの更新
- スプレッドシートURLからインポートしたリストは、「アイテム更新」で最新データを取得できます
- 更新時は、削除・更新・追加されるアイテムが確認ダイアログで表示されます

---

## ⚠️ 注意事項

- **データの保存場所**: データはブラウザのローカルストレージに保存されます
- **データの削除**: ブラウザのデータを削除すると、保存されたデータも失われます
- **スプレッドシートの設定**: スプレッドシートは公開設定（「リンクを知っている全員が閲覧可」）にする必要があります
- **バックアップ**: 定期的なCSVエクスポートによるバックアップを推奨します
- **長押し操作**: メニュー表示やモード切り替えは500msの長押しが必要です
- **オフライン動作**: PWA対応のため、一度アクセスすればオフラインでも動作します

---

## 📝 技術スタック

- React 18
- TypeScript
- Vite
- PWA対応（オフライン動作可能）
